# 依赖说明

## Introduction

项目的依赖统一由顶级pom进行版本管理，保证每个模块保证都是最小依赖。

该文针对项目中的每个依赖进行详细的说明，具体说明根据`gourpId`进行粗分，`artifactId`进行细化的二级分类说明。

## 核心依赖

所有模块依赖的共同依赖：

- lombok: 自动插入编辑器和构建工具中，Lombok提供了一组有用的注释，用来消除Java类中的大量样板代码。
- org.apache.commons
  - commons-langs: 非常流行的库，包括很多功能齐全的工具类，可以扩展Java的能力。 其中内容相当丰富，包括字符串、数组以及数值操作，反射和并发，以及几个顺序数据结构实现（pair和triple）。
  - commons-beanutils: 用于操作JavaBean的工具包。
- org.springframework.boot
  - spring-boot-starter-test: 为Spring Boot应用提供测试
- org.springframework.cloud
  - spring-cloud-starter-bootstrap: 由 spring-cloud-commons 提供的 Bootstrap 默认不再启用。如果您的项目需要它，可以通过属性或新的启动器重新启用它。要通过属性设置` spring.cloud.bootstrap.enabled=true` 或 `spring.config.use-legacy-processing=true` 重新启用。这些需要设置为环境变量、java 系统属性或命令行参数。另一种选择是包含新的 spring-cloud-starter-bootstrap （在您的 POM 文件中）。

## 依赖管理

Spring相关：

- org.springframework.boot
  - spring-boot-dependencies: springboot的依赖管理器（意味着springboot每发布版本都会规划它所支持的依赖项，实际上无需指定这些依赖项的版本号）。
- org.springframework.cloud
  - spring-cloud-dependencies: 同spring-boot-dependencies一样，是对cloud的依赖管理器。
  - spring-cloud-starter-oauth2: 整合OAuth2。
- org.springframework.social
  - spring-social-security: Spring Security集成。
  - spring-security-oauth2: 为OAuth2提供Spring Security支持。
  - spring-security-jwt: Spring Security JWT是一个用于编码和解码JSON Web令牌的小型实用程序库。它属于Spring Security加密库系列，该库将编码和解码文本处理为一个通用的。
- com.alibaba
  - spring-cloud-alibaba-dependencies: spring-cloud-alibaba依赖管理器。
  - druid-spring-boot-starter: druid数据库连接池。
  - transmittable-thread-local: TTL实现父子线程的数据传递。
- de.codecentric: springbootAdmin是由codecentric组织开发
  - spring-boot-admin-starter-server: 管理和监控springboot项目，包含客户端和服务端，客户端添加暴露相关的HTTP接口，然后注册到Spring Boot Admin服务端。
- io.jsonwebtoken
  - jjwt: JSON web token支持。
- com.baomidou: mybatis ORM层框架
  - mybatis-plus
  - mybatis-plus-boot-starter
  - mybatis-plus-extension
- org.hibernate
  - hibernate-valildator: 运行时的数据校验框架，即服务端的数据校验。
- cn.hutool
  - hutoo-all: hutool Java工具库。
- com.fasterxml.jackson.core
  - jackson-databind: Jackson的常规数据绑定功能，适用于核心流 API。
- org.redission
  - redission-spring-boot-starter: 在Redis基础上的一个实用Java工具包。
- org.apache
  - commons
    - commons-io: 包含工具类、流接口、文件过滤、文件比较器等。
  - poi
    - poi: 用于接受Microsoft格式的文件。
    - poi-ooxml: 同上。
- cn.afterturn
  - easypoi-base: 用于word、pdf、excel等。
- eu.bitwalker
  - UserAgentUtils: user-agent-utils java 库可用于实时解析 HTTP 请求，或用于分析日志文件并收集有关 user-agent 的信息。
- com.nepxion
  - banner: 带有色彩展示的banner组件。
- com.github.xiaoymin: 统一API文档中心。
  - knife4j-spring-boot-starter
  - knife4j-micro-spring-boot-starter

> 关于依赖管理器，一种使用spring-boot-starter-parent进行springboot的版本管理，这样在导入其他starters可以忽略版本号；一种是通过如下方式。

```xml
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-dependencies</artifactId>
  <version>${spring-boot-dependencies.version}</version>
  <type>pom</type>
  <scope>import</scope>
</dependency>
<dependency>
  <groupId>org.springframework.cloud</groupId>
  <artifactId>spring-cloud-dependencies</artifactId>
  <version>${spring-cloud-dependencies.version}</version>
  <type>pom</type>
  <scope>import</scope>
</dependency>

```

## 相关插件

插件管理如下：

```xml
    <build>
        <pluginManagement>
            <plugins>
                <plugin>
                    <groupId>org.springframework.boot</groupId>
                    <artifactId>spring-boot-maven-plugin</artifactId>
                    <version>${spring-boot-dependencies.version}</version>
                </plugin>
                <plugin>
                    <groupId>com.spotify</groupId>
                    <artifactId>docker-maven-plugin</artifactId>
                    <version>${docker-maven-plugin.version}</version>
                </plugin>
            </plugins>
        </pluginManagement>
    </build>
```

spring-boot-maven-plugin: 在打Jar包时会引入依赖包，可以直接打成直接运行的Jar包。

- 在使用spring-boot-maven-plugin插件时，打包后的目录包括三个，BOOT-INF,META-INF,org.springframework.boot.loader，在lib目录里包含了我自己的项目的代码目录；在没有使用spring-boot-maven-plugin插件时，打包的目录只有两个，META-INF和我自己的项目代码的目录。

docker-maven-plugin: 在持续集成过程中，项目工程一般使用 Maven 编译打包，后生成镜像，通过上传镜像，能够大大提高上线效率，同时能够快速动态扩容，快速回滚。docker-maven-plugin 插件可以帮助我们在Maven工程中，通过简单的配置，自动生成镜像并推送到仓库中。

具体Docker构建配置：

```xml
    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <executions>
                    <execution>
                        <goals>
                            <goal>repackage</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>com.spotify</groupId>
                <artifactId>docker-maven-plugin</artifactId>
                <configuration>
                    <imageName>${docker.image.prefix}/${project.artifactId}</imageName>
                    <imageTags>
                        <imageTag>${project.version}</imageTag>
                        <imageTag>latest</imageTag>
                    </imageTags>
                    <forceTags>true</forceTags>
                    <baseImage>${docker.baseImage}</baseImage>
                    <volumes>${docker.volumes}</volumes>
                    <env>
                        <JAVA_OPTS>${docker.java.opts}</JAVA_OPTS>
                    </env>
                    <entryPoint>["sh","-c","java $JAVA_OPTS ${docker.java.security.egd} -jar /${project.build.finalName}.jar"]</entryPoint>
                    <resources>
                        <resource>
                            <targetPath>/</targetPath>
                            <directory>${project.build.directory}</directory>
                            <include>${project.build.finalName}.jar</include>
                        </resource>
                    </resources>
                </configuration>
            </plugin>
        </plugins>
        <finalName>${project.artifactId}</finalName>
    </build>
```

配置说明：

- imageName：为镜像名
- imageTags：配置镜像tag，这里指定了两个tag(最新的版本号和latest)
- forceTags：强制在每次新的构建上覆盖镜像tags
- baseImage：基础镜像
- volumes：配置挂载目录
- env：配置环境变量
- entryPoint：配置执行命令
- resources：配置目标jar包的位置

参数解释：

- docker.baseImage：为jre8的基础镜像
- docker.volumes：是在容器里挂载的目录
- docker.image.prefix：仓库地址/项目名
- docker.java.security.egd：加快随机数产生过程
- docker.java.opts：设置JVM启动参数

打包成docker推送到仓库命令：`mvn docker:build`

## 具体依赖

### 自定义spring-boot-starter

#### 日志模块

被所有模块依赖，为最底层组件。

- org.springframework
  - spring-web(optional)

- org.springframework.boot
  - spring-boot-starter
  - spring-boot-configuration-processor(optional): 支持自定义配置。
  - spring-boot-starter-aop: AOP模块。
  - spring-boot-starter-jdbc(optional): JDBC模块。

- org.springframework.cloud
  - spring-cloud-context: Spring Cloud Context 为Spring Cloud应用程序的 ApplicationContext （ bootstrap 引导程序上下文， encryption 加密， refreshScope 刷新作用域和环境端点）提供实用程序和特殊服务。
- javax.servlet
  - javax.servlet-api(optional): servlet开发时候的环境支持。
- com.alibaba
  - transmittable-thread-local: 解决MDC父子线程传递的问题。
- cn.hutool
  - hutool-all: 工具包。
- io.github.openfeign
  - feign-core(optional): 声明式、模版化的HTTP服务调用。

## Reference

- cloud-bootstrap依赖问题：https://stackoverflow.com/questions/65063402/why-bootstrap-properties-is-ignored-by-spring-cloud-starter-config
- 依赖管理：https://segmentfault.com/a/1190000018854658、https://www.cnblogs.com/ld-mars/p/11720444.html
- UserAgent官网：https://www.bitwalker.eu/software/user-agent-utils

