# 前端文档

## 一、项目概览

### 1.1 项目结构

```
|-assets
|     |-css                     // 样式
|     |-images                  // 图片
|     |-libs                    // 第三方库
|
|-pages            // html组件
|     |-system                  // 系统管理页面
|     |-xxxxxx                  // 其他业务页面
|     |-tpl                     // 公用组件
|     |     |-message.html                 // 消息
|     |-console.html            // 主页一
|     |-header.html             // 头部
|     |-side.html               // 侧导航
|
|-module                // js模块 (使用layui的模块开发方式)
|     |-admin.js                // admin模块
|     |-config.js                // config模块
|     |-index.js                // index模块
|
|-index.html            // 主界面
|-login.html            // 登陆界面
```

> 不分离版没有pages目录，不分离版的页面由后台输出，前端只有assets和module

## 1.2 开发规范

1. css、图片、第三方lib（layui扩展模块除外）全部放在“/assets/”下面；
2. layui扩展模块放在“module”下面，例如项目里面“formSelects”模块；
3. 页面html放在“pages”下面。

> 注意：不分离版本html不需要放在“pages”下面，随便放，因为是后端渲染，前端只需要访问后端的url。 比如我这里不分离版本是放在templates目录下面，templates是SpringBoot默认的视图目录。

## 二、开发指南

### “config”模块

“config”模块主要是配置项目的一些基本参数。

| 名称        | 类型 | 描述                                                 |
| ----------- | ---- | ---------------------------------------------------- |
| base_server | 变量 | 服务器接口地址                                       |
| tableName   | 变量 | 本地存储表名（token等都会存储在本地中）              |
| pageTabs    | 变量 | 是否开启多标签模式，(**不分离版本在index.js中配置**) |
| getToken    | 方法 | 获取缓存的token                                      |
| putToken    | 方法 | 缓存token                                            |
| removeToken | 方法 | 清除缓存的token                                      |
| menus       | 变量 | 侧导航菜单数组，侧导航根据menus自动渲染              |
| getUser     | 方法 | 获取缓存的用户信息                                   |
| putUser     | 方法 | 缓存用户的信息                                       |

注意：因为我这边的后台返回的token是这样的

```json
{
    "access_token": "950a7cc9-5a8a-42c9-a693-40e817b1a4b0",
    "token_type": "bearer",
    "refresh_token": "773a0fcd-6023-45f8-8848-e141296cb3cb",
    "expires_in": 27036,
    "scope": "select"
}
```

  所以我这边的token不是一个字符串存储的，是用json存储的，getToken返回的是一个json对象， 如果你的token只是一个字符串，请修改getToken方法和admin里面的req方法，当然我建议最好 命令你的后台人员按这个json格式返回数据，这个是一个标准的格式。

## 三、开发样式

layui图标：http://www.baoxiuyun.net/element/icon.html

layer.icon：

1. OK
2. ❌错误
3. ❓？
4. 🔒无权
5. 😫不开心 - 超时
6. 😄开心

## 四、具体页面逻辑

### 4.1封装ajax请求

具体逻辑：

```javascript
  admin.req('api-user/users/current', {}, function (data) {
    layer.close(loadIndex);
    if (data.resp_code === 0) {
      let user = data.data;
      djjConfig.putUser(user);
      admin.putTempData("permissions", user.permissions);
      success(user);
    } else {
      layer.msg('获取用户失败', {icon: 2, time: 1000});
      djjConfig.removeToken();
      location.replace('login.html');
    }
  }, 'GET', {headers: {'Authorization': 'Bearer ' + token.access_token}});
```

### 添加页面

页面案例参考：

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Token管理</title>
    <link rel="stylesheet" href="../../assets/libs/layui/css/layui.css"/>
    <link rel="stylesheet" href="../../assets/module/admin.css?v=318"/>
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-header">
            <h2 class="header-title">token管理</h2>
        </div>
        <div class="layui-card-body">
            <form class="layui-form toolbar">
                <div class="layui-inline">
                    <label class="layui-form-label">用户名:</label>
                    <div class="layui-input-inline">
                        <input name="username" class="layui-input" placeholder="输入用户名"/>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">&emsp;
                        <button class="layui-btn icon-btn" lay-filter="TokensTbSearch" lay-submit>
                            <i class="layui-icon">&#xe615;</i>搜索
                        </button>
                    </div>
                </div>
            </form>
            <!-- 数据表格 -->
            <table id="tokensTable" lay-filter="tokensTable"></table>
        </div>
    </div>
</div>

<script type="text/html" id="tokensTableBar">
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
<script>
    layui.use(['layer', 'form', 'table', 'util', 'admin', 'zTree', 'djj_config'], function () {
        var $ = layui.jquery;
        var layer = layui.layer;
        var form = layui.form;
        var table = layui.table;
        var util = layui.util;
        var admin = layui.admin;
        var djjConfig = layui.djj_config;

        table.render({
            elem: '#tokensTable',
            url: djjConfig.base_server + 'api-uaa/tokens',
            method: 'GET',
            headers:{'Authorization': 'Bearer ' + djjConfig.getToken().access_token},
            page: true,
            col: [[
                
            ]]
        });
    });
</script>
</body>
</html>
```



### 模版引擎使用

参考：https://www.layuion.com/demo/laytpl.html

例如返回的对象user：

```json
{"data":{"id":1,"createTime":"2021-12-26T05:47:55.000+00:00","updateTime":"2021-12-26T05:47:55.000+00:00","username":"admin","password":"{bcrypt}$2a$10$H5iFnJeqVtYmrx1d6XsNBOIRZB0LBvGLUpH2j2inDbhhP45q3yyJG","nickname":"管理员","headImgUrl":"0","mobile":"15112343188","sex":null,"type":"ADMIN","openId":null,"isEnable":true,"isDel":false,"roles":[],"roleId":null,"oldPassword":null,"newPassword":null,"permissions":null,"authorities":[],"accountNonExpired":true,"accountNonLocked":true,"credentialsNonExpired":true,"userId":null,"enabled":true},"resp_code":0,"resp_msg":""}
```

通过该数据填充到用户头像和昵称：

```javascript
  myIndex.getUser(function (user) {
    console.log(user)
    let userShow = admin.util.tpl(
      '                <a>\n' +
      '                    <img src="assets/images/head.jpg" class="layui-nav-img">\n' +
      '                    <cite>{{d.nickname}}</cite>\n' +
      '                </a>',
      user
    );
    $("#userShow").html(userShow);
  });
```

以上方式过于麻烦，采用插件-Pandyle。

## 插件说明

### eCharts

> 一个基于 JavaScript 的开源可视化图表库



### Pandyle

pandyle是一个基于jquery的MVVM库。它为jquery提供了基本的模板和组件功能。pandyle秉承jquery — **write less, do more** 的设计理念，主要关注点即在于**简单**，它的大小只有7kb（压缩后），易学易用，努力减少你书写的代码量，并且更贴合传统的jquery的书写方式。

> 什么是MVVM？[MVVM](https://en.wikipedia.org/wiki/Model–view–viewmodel)是Model-View-ViewModel的缩写。

要编写可维护的前端代码绝非易事。我们已经用MVC模式通过koa实现了后端数据、模板页面和控制器的分离，但是，对于前端来说，还不够。

这里有童鞋会问，不是讲Node后端开发吗？怎么又回到前端开发了？

对于一个全栈开发工程师来说，懂前端才会开发出更好的后端程序（不懂前端的后端工程师会设计出非常难用的API），懂后端才会开发出更好的前端程序。程序设计的基本思想在前后端都是通用的，两者并无本质的区别。这和“不想当厨子的裁缝不是好司机”是一个道理。

当我们用Node.js有了一整套后端开发模型后，我们对前端开发也会有新的认识。由于前端开发混合了HTML、CSS和JavaScript，而且页面众多，所以，代码的组织和维护难度其实更加复杂，这就是MVVM出现的原因。

使用说明：[使用WIKI](https://github.com/RenRongrong/pandyle/wiki)

#### 组件

p-com属性提供组件功能。pandyle中的组件实质就是一段html代码，在标签中使用p-com属性来指定组件的名称。VM会根据p-com中指定的名称和Pandyle配置中的comPath字段去加载对应的组件并渲染。如果没有设置comPath，VM会在默认的`./components`文件夹中寻找对应名称的组件。

关于p-bind和p-com的顺序:在渲染模板时，p-bind的解析在p-com之前，因此，你可以使用p-bind来动态加载组件。



## layui

### Introduction

layui（谐音：类 UI) 是一套开源的 Web UI 解决方案，采用自身经典的模块化规范，并遵循原生 HTML/CSS/JS 的开发方式，极易上手，拿来即用。其风格简约轻盈，而组件优雅丰盈，从源代码到使用方法的每一处细节都经过精心雕琢，非常适合网页界面的快速开发。layui 区别于那些基于 MVVM 底层的前端框架，却并非逆道而行，而是信奉返璞归真之道。准确地说，它更多是面向后端开发者，你无需涉足前端的各种工具，只需面对浏览器本身，让一切你所需要的元素与交互，从这里信手拈来。

**目录结构**

```
code
  ├─css //css目录
  │  │─modules //模块 css 目录（一般如果模块相对较大，我们会单独提取，如下：）
  │  │  ├─laydate
  │  │  └─layer
  │  └─layui.css //核心样式文件
  ├─font  //字体图标目录
  └─layui.js //核心库
     
```

**模块引入**

```javascript
//layui 模块的定义（新 js 文件）
layui.define([mods], function(exports){
  
  //……
  
  exports('mod', api);
});  
 
//layui 模块的使用
layui.use(['mod1', 'mod2'], function(args){
  var mod = layui.mod1;
  
  //……
  
});    
```

**管理拓展模块**

```javascript
//mod1.js
layui.define('layer', function(exports){
  //…
  exports(mod1, {});
});
 
//mod2.js，假设依赖 mod1 和 form
layui.define(['mod1', 'form'], function(exports){
  //…
  exports(mod2, {});
});  
 
//mod3.js
//… 
 
//main.js 主入口模块
layui.define('mod2', function(exports){
  //…
  exports('main', {});
});
      
```

## 页面元素

### 布局容器

1. 固定宽度（两侧具有留白效果）:`<div class="layui-container">`。
2. 完整宽度（占据屏幕100%）:`<div class="layui-fluid>"`。

### 栅格系统

| 1.   | 采用 *layui-row* 来定义行，如：*<div class="layui-row"></div>* |
| ---- | ------------------------------------------------------------ |
| 2.   | 采用类似 *layui-col-md** 这样的预设类来定义一组列（column），且放在行（row）内。其中：变量*md* 代表的是不同屏幕下的标记（可选值见下文）变量*** 代表的是该列所占用的12等分数（如6/12），可选值为 1 - 12如果多个列的“等分数值”总和等于12，则刚好满行排列。如果大于12，多余的列将自动另起一行。 |
| 3.   | 列可以同时出现最多四种不同的组合，分别是：*xs*（超小屏幕，如手机）、*sm*（小屏幕，如平板）、*md*（桌面中等屏幕）、*lg*（桌面大型屏幕），以呈现更加动态灵活的布局。 |
| 4.   | 可对列追加类似 *layui-col-space5*、 *layui-col-md-offset3* 这样的预设类来定义列的间距和偏移。 |
| 5.   | 最后，在列（column）元素中放入你自己的任意元素填充内容，完成布局！ |

- 这里注意下，响应式的区别，位于不同屏幕端，表现也不同。

### 数据表格table

**快速使用**

创建一个table实例最简单的方式是，在页面放置一个元素 *<table id="demo"></table>*，然后通过 *table.render()* 方法指定该容器。

```javascript	
<script>
layui.use('table', function(){
  var table = layui.table;
  
  // 加载实例
  table.render({
    elem: '#demo' // 用于绑定容器
    ,height: 312
    ,url: '/demo/table/user/' //数据接口
    ,page: true //开启分页
    ,cols: [[ //表头
      {field: 'id', title: 'ID', width:80, sort: true, fixed: 'left'}
      ,{field: 'username', title: '用户名', width:80}
      ,{field: 'sex', title: '性别', width:80, sort: true}
      ,{field: 'city', title: '城市', width:80} 
      ,{field: 'sign', title: '签名', width: 177}
      ,{field: 'experience', title: '积分', width: 80, sort: true}
      ,{field: 'score', title: '评分', width: 80, sort: true}
      ,{field: 'classify', title: '职业', width: 80}
      ,{field: 'wealth', title: '财富', width: 135, sort: true}
    ]]
  });
  
});
</script>
```



```javascript
var tableObj = table.render({});
tableObj.reload(options); //重载表格
```

1. 

### 表单form

官网：https://www.layuion.com/doc/modules/form.html

> 在一个容器中设定 *class="layui-form"* 来标识一个表单元素块，通过规范好的HTML结构及CSS类，来组装成各式各样的表单元素，并通过内置的 *form模块* 来完成各种交互。
>
> 依赖加载模块：[form](https://www.layuion.com/doc/modules/form.html) （请注意：如果不加载form模块，select、checkbox、radio等将无法显示，并且无法使用form相关功能）

**更新渲染**

执行 *form.render(type, filter);* 方法即可。

第一个参数：type，为表单的 type 类型，可选。默认对全部类型的表单进行一次更新。可局部刷新的 type 如下表：

| 参数（type）值 | 描述                             |
| :------------- | :------------------------------- |
| select         | 刷新select选择框渲染             |
| checkbox       | 刷新checkbox复选框（含开关）渲染 |
| radio          | 刷新radio单选框框渲染            |

```
例子codeform.render(); //更新全部form.render('select'); //刷新select选择框渲染//……      
```

第二个参数：filter，为 *class="layui-form"* 所在元素的 *lay-filter=""* 的值。你可以借助该参数，对表单完成局部更新。

```
例子code【HTML】<div class="layui-form" lay-filter="test1">  …</div> <div class="layui-form" lay-filter="test2">  …</div>      【JavaScript】form.render(null, 'test1'); //更新 lay-filter="test1" 所在容器内的全部表单状态form.render('select', 'test2'); //更新 lay-filter="test2" 所在容器内的全部 select 状态//……      
```

**输入框**

```
<input type="text" name="title" required lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input">          
```

1. *required*：注册浏览器所规定的必填字段
2. *lay-verify*：注册form模块需要验证的类型
3. *class="layui-input"*：layui.css提供的通用CSS类

**下拉选择框**

```html
<select name="city" lay-verify="">
  <option value="">请选择一个城市</option>
  <option value="010">北京</option>
  <option value="021">上海</option>
  <option value="0571">杭州</option>
</select>     
```

上述option的第一项主要是占个坑，让form模块预留“请选择”的提示空间，否则将会把第一项（存在value值）作为默认选中项。你可以在option的空值项中自定义文本，如：请选择分类。

通过设定*selected*来设置默认选中项。

**表单赋值/取值**

语法：*form.val('filter', object);*

用于给指定表单集合的元素赋值和取值。如果 object 参数存在，则为赋值；如果 object 参数不存在，则为取值。
注：其中「取值」功能为 layui 2.5.5 开始新增

```javascript
//给表单赋值
form.val("formTest", { //formTest 即 class="layui-form" 所在元素属性 lay-filter="" 对应的值
  "username": "贤心" // "name": "value"
  ,"sex": "女"
  ,"auth": 3
  ,"check[write]": true
  ,"open": false
  ,"desc": "我爱layui"
});
 
//获取表单区域所有值
var data1 = form.val("formTest");
```

第二个参数中的键值是表单元素对应的 *name* 和 *value*。

### 树形表格treeTable

官方：https://gitee.com/pang123/treetable-lay#%E7%AE%80%E4%BB%8B

原本的项目地址丢失。

#### 基础参数一览表

| 参数         | 类型          | 说明                              | 示例值                           |
| ------------ | ------------- | --------------------------------- | -------------------------------- |
| elem         | String/DOM    | 指定原始 table 容器的选择器或 DOM | '#demo'                          |
| cols         | Array         | 设置表头。值是一维数组            | 详见表头参数                     |
| data         | Array         | 直接赋值数据                      | [{}, {}, {}, {}, …]              |
| width        | Number        | 设定容器宽度                      | 350                              |
| height       | Number/String | 设定容器高度                      | 300 / 'full-150'                 |
| cellMinWidth | Number        | 定义所有单元格的最小宽度          | 100                              |
| text         | Object        | 自定义文本，如空数据提示等        | 详见自定义文本                   |
| skin         | String        | 设定表格风格                      | line行边框、row列边框、nob无边框 |
| even         | Boolean       | 开启隔行背景                      | true/false                       |
| size         | String        | 设定表格尺寸                      | sm 小尺寸、lg 大尺寸             |
| tree         | Object        | 设定树相关参数                    | 详见树相关参数                   |
| style        | String        | 设定容器的样式                    | 'margin-top: 0;'                 |
| getThead     | Function      | 自定义表头                        | 详见自定义表头                   |
| reqData      | Function      | 懒加载数据                        | 详见懒加载数据                   |

#### 表头参数一览表cols

| 参数       | 类型    | 说明                           | 示例值                                                |
| ---------- | ------- | ------------------------------ | ----------------------------------------------------- |
| field      | String  | 设定字段名                     | 'username'                                            |
| title      | String  | 设定标题名称                   | 用户名                                                |
| width      | Number  | 设定列宽，若不填写，则自动分配 | 150、20%(数字和百分比)                                |
| minWidth   | Number  | 单元格的最小宽度               | 100(数字)                                             |
| type       | String  | 设定列类型                     | checkbox复选框、radio单选框、numbers序号列、space空列 |
| edit       | String  | 单元格编辑类型                 | text（输入框）、number(数字输入框)                    |
| style      | String  | 自定义单元格样式               | color: red;                                           |
| class      | String  | 自定义单元格class              | class: 'pd-tb-0';                                     |
| align      | String  | 单元格排列方式                 | center居中、right居右                                 |
| templet    | String  | 自定义列模板                   | 详见自定义列模板                                      |
| toolbar    | String  | 绑定工具条模板                 | 详见行工具事件                                        |
| singleLine | Boolean | 是否单行显示，溢出悬浮展开     | true/false                                            |

> templet和toolbar用法与数据表格table模块一致

#### 树相关参数一览表tree

| 参数            | 类型     | 说明                                    | 示例值             |
| --------------- | -------- | --------------------------------------- | ------------------ |
| iconIndex       | Number   | 图标列的索引                            | 默认0              |
| onlyIconControl | Boolean  | 仅允许点击图标折叠                      | 默认false          |
| arrowType       | String   | 箭头类型                                | 可选'arrow2'       |
| getIcon         | Function | 自定义树形图标                          | 详见自定义树形图标 |
| isPidData       | Boolean  | 是否是pid形式的数据，懒加载方式不需要   | 默认false          |
| idName          | String   | 设定id的字段名                          | 默认'id'           |
| pidName         | String   | 设定pid的字段名，children形式数据不需要 | 默认'pid'          |
| childName       | String   | 设定children的字段名，pid形式数据不需要 | 默认'children'     |
| haveChildName   | String   | 设定是否有子集的字段名，用于懒加载      | 默认'haveChild'    |
| openName        | String   | 设定是否默认展开的字段名                | 默认'open'         |

### xmSelect使用说明

官网：https://maplemei.gitee.io/xm-select/#/component/install

formSelects升级到xmSelect。

数据传入：

```javascript	
xmSelect.render({
  el: '#roleId',
  name: 'roleIds', // 对应后端的值
  data: selectData
});
```

## Reference

- 前端文档：https://www.kancloud.cn/sansui/easyweb/2141290
- pandyle：https://www.bookstack.cn/read/pandyle/7cf24484e036db71.md ｜ https://github.com/RenRongrong/pandyle
- echarts：https://echarts.apache.org/handbook/zh/get-started/
- 学习参考：
  - https://www.binglei.xyz/?p=590
  - https://github.com/caozxvip/zbx-doc